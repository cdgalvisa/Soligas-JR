/*!
wookmark plugin
@name wookmark.js
@author Christoph Ono (chri@sto.ph or @gbks)
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 2.0.1
@date 06/16/2015
@category jQuery plugin
@copyright (c) 2009-2015 Christoph Ono (www.wookmark.com)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
!function(n){"function"==typeof define&&define.amd?define(["window","document"],n):n(window,document)}(function(n,t){function r(n,t){return function(){return n.apply(t,arguments)}}function c(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.style[i]=t[i])}function l(n){nt(function(){for(var i,t=0;t<n.length;t++)i=n[t],c(i.el,i.css)})}function e(n){return n.replace(/^\s+|\s+$/g,"").toLowerCase()}function o(n,t,i){n.removeEventListener?n.removeEventListener(t,i):n.detachEvent("on"+t,i)}function a(n,t,i){o(n,t,i);n.addEventListener?n.addEventListener(t,i):n.attachEvent("on"+t,function(){i.call(n)})}function y(n){return null===n.offsetParent}function p(n){return n.offsetHeight}function s(n){return n.offsetWidth}function w(n,t){return n.classList?n.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(n.className)}function b(n,t){n.classList?n.classList.add(t):n.className+=" "+t}function k(n,t){n.classList?n.classList.remove(t):n.className=n.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function u(n,t,i,r){void 0===r&&(r="wookmark-");var u=n.getAttribute("data-"+r+t);return i===!0?parseInt(u,10):u}function f(n,t,i,r){void 0===r&&(r="wookmark-");n.setAttribute("data-"+r+t,i)}function d(n){for(var t,r={},f=[],i=n.length;i--;)t=u(n[i],"id",!0),r.hasOwnProperty(t)||(r[t]=1,f.push(n[i]));return f}function v(t,i){return void 0!==n.getComputedStyle?n.getComputedStyle(t,null).getPropertyValue(i):t.currentStyle[i]}function g(n,t){for(var r=n.length,i=0;r>i;i++)if(n[i]===t)return i;return-1}function i(i,u){u=u||{};"string"==typeof i&&(i=t.querySelector(i));this.container=i;this.columns=this.containerWidth=this.resizeTimer=null;this.activeItemCount=0;this.placeholders=[];this.itemHeightsInitialized=!1;this.itemHeightsDirty=!1;this.elementTag="div";this.initItems=r(this.initItems,this);this.updateOptions=r(this.updateOptions,this);this.onResize=r(this.onResize,this);this.onRefresh=r(this.onRefresh,this);this.getItemWidth=r(this.getItemWidth,this);this.layout=r(this.layout,this);this.layoutFull=r(this.layoutFull,this);this.layoutColumns=r(this.layoutColumns,this);this.filter=r(this.filter,this);this.clear=r(this.clear,this);this.getActiveItems=r(this.getActiveItems,this);this.refreshPlaceholders=r(this.refreshPlaceholders,this);this.sortElements=r(this.sortElements,this);this.updateFilterClasses=r(this.updateFilterClasses,this);this.initItems();this.container.style.display="block";this.updateOptions(u);this.updateFilterClasses();this.autoResize&&a(n,"resize",this.onResize);a(this.container,"refreshWookmark",this.onRefresh)}var h={align:"center",autoResize:!0,comparator:null,direction:void 0,ignoreInactiveItems:!0,inactiveClass:"wookmark-inactive",itemSelector:void 0,itemWidth:0,fillEmptySpace:!1,flexibleWidth:0,offset:5,outerOffset:0,onLayoutChanged:void 0,placeholderClass:"wookmark-placeholder",possibleFilters:[],resizeDelay:50,verticalOffset:void 0},nt=n.requestAnimationFrame||function(n){n()};return i.prototype.initItems=function(){if(void 0===this.itemSelector){for(var n,i=[],r=this.container.children,t=r.length;t--;)n=r[t],8!==n.nodeType&&(n.style.display="",f(n,"id",t),i.unshift(n));this.items=i}else this.items=this.container.querySelectorAll(this.itemSelector);this.items.length&&(this.elementTag=this.items[0].tagName);this.itemHeightsDirty=!0},i.prototype.updateFilterClasses=function(){for(var r,t,f,i,o,s=this.items.length,n={},h=this.possibleFilters,c=h.length;s--;)if(f=this.items[s],t=JSON.parse(u(f,"filter-class",!1,"")),t&&"object"==typeof t)for(r=t.length;r--;)i=e(t[r]),n.hasOwnProperty(i)||(n[i]=[]),n[i].push(f);for(;c--;)o=e(h[c]),n.hasOwnProperty(o)||(n[o]=[]);this.filterClasses=n},i.prototype.updateOptions=function(n){var t;this.itemHeightsDirty=!0;n=n||{};for(t in h)h.hasOwnProperty(t)&&(n.hasOwnProperty(t)?this[t]=n[t]:this.hasOwnProperty(t)||(this[t]=h[t]));this.verticalOffset=this.verticalOffset||this.offset;this.layout(!0)},i.prototype.onResize=function(){clearTimeout(this.resizeTimer);this.itemHeightsDirty=0!==this.flexibleWidth;this.resizeTimer=setTimeout(this.layout,this.resizeDelay)},i.prototype.onRefresh=function(){this.itemHeightsDirty=!0;this.layout()},i.prototype.filter=function(n,t,i){var h,r,a,v,y,o=[],u=[],c,p,l,f,s;if(n=n||[],t=t||"or",i=i||!1,n.length){for(r=0;r<n.length;r++)y=e(n[r]),this.filterClasses.hasOwnProperty(y)&&o.push(this.filterClasses[y]);if(r=h=o.length,"or"===t||1===h)for(;r--;)u=u.concat(o[r]);else if("and"===t){for(f=o[0],s=!0;r--;)o[r].length<f.length&&(f=o[r]);for(f=f||[],r=f.length;r--;){for(p=f[r],a=h,s=!0;a--&&s;)if(l=o[a],f!==l){for(c=!1,v=l.length;v--&&!c;)c=l[v]===p;s&=c}s&&(u=u.concat(f[r]))}}if(h>1&&(u=d(u)),!i)for(r=this.items.length;r--;)-1===g(u,this.items[r])&&b(this.items[r],this.inactiveClass)}else u=this.items;if(!i){for(r=u.length;r--;)k(u[r],this.inactiveClass);this.columns=null;this.layout()}return u},i.prototype.refreshPlaceholders=function(n,t){var i,r,e,f,o,s,h,y=p(this.container),l=this.columns.length,a="";if(this.placeholders.length<l){for(i=0;i<l-this.placeholders.length;i++)a+="<"+this.elementTag+' class="'+this.placeholderClass+'"/>';this.container.insertAdjacentHTML("beforeend",a);this.placeholders=this.container.querySelectorAll("."+this.placeholderClass)}for(f=this.offset+2*parseInt(v(this.placeholders[0],"border-left-width"),10)||0,f+=2*parseInt(v(this.placeholders[0],"padding-left"),10)||0,i=0;i<this.placeholders.length;i++)s=this.placeholders[i],r=this.columns[i],i>=l||0===r.length?s.style.display="none":(o=r[r.length-1],h=u(o,"top",!0)+u(o,"height",!0)+this.verticalOffset,e=Math.max(0,y-h-f),c(s,{position:"absolute",display:e>0?"block":"none",left:i*n+t+"px",top:h+"px",width:n-f+"px",height:e+"px"}))},i.prototype.getActiveItems=function(){var n,t,u=this.inactiveClass,i=[],r=this.items;if(this.ignoreInactiveItems)for(n=0;n<r.length;n++)t=r[n],w(t,u)||i.push(t);return i},i.prototype.getItemWidth=function(){var n=this.itemWidth,i=s(this.container)-2*this.outerOffset,t=this.flexibleWidth;if("function"==typeof n&&(n=this.itemWidth()),this.items.length>0&&(void 0===n||0===n&&!this.flexibleWidth)?n=s(this.items[0]):"string"==typeof n&&n.indexOf("%")>=0&&(n=parseFloat(this.itemWidth)/100*i),t){"function"==typeof t&&(t=t());"string"==typeof t&&t.indexOf("%")>=0&&(t=parseFloat(t)/100*i);var r=i+this.offset,f=Math.floor(.5+r/(t+this.offset)),e=Math.floor(r/(n+this.offset)),u=Math.max(f,e),o=Math.min(t,Math.floor((i-(u-1)*this.offset)/u));n=Math.max(n,o)}return n},i.prototype.layout=function(n,t){if(!y(this.container)){var e,h=this.getItemWidth(),i=h+this.offset,p=s(this.container),c=p-2*this.outerOffset,r=Math.floor((c+this.offset)/i),u=0,l=0,a=this.getActiveItems(),o=a.length,v=o;if(this.itemHeightsDirty||!this.itemHeightsInitialized){for(;v--;)e=a[v],this.flexibleWidth&&(e.style.width=h+"px"),f(e,"height",e.offsetHeight);this.itemHeightsDirty=!1;this.itemHeightsInitialized=!0}r=Math.max(1,Math.min(r,o));u=this.outerOffset;"center"===this.align&&(u+=Math.floor(.5+(c-(r*i-this.offset))>>1));this.direction=this.direction||("right"===this.align?"right":"left");l=n||null===this.columns||this.columns.length!==r||this.activeItemCount!==o?this.layoutFull(i,r,u):this.layoutColumns(i,u);this.activeItemCount=o;this.container.style.height=l+"px";this.fillEmptySpace&&this.refreshPlaceholders(i,u);void 0!==this.onLayoutChanged&&"function"==typeof this.onLayoutChanged&&this.onLayoutChanged();"function"==typeof t&&t()}},i.prototype.sortElements=function(n){return"function"==typeof this.comparator?n.sort(this.comparator):n},i.prototype.layoutFull=function(n,t,i){var s,a,p,v,e=0,h=0,c=null,o=null,r=[],y=[],w="left"===this.align;for(this.columns=[],a=this.sortElements(this.getActiveItems()),p=a.length;r.length<t;)r.push(this.outerOffset),this.columns.push([]);for(;p>h;){for(s=a[h],c=r[0],o=0,e=0;t>e;e++)r[e]<c&&(c=r[e],o=e);f(s,"top",c);v=i;(o>0||!w)&&(v+=o*n);y[h]={el:s,css:{position:"absolute",top:c+"px"}};y[h].css[this.direction]=v+"px";r[o]+=u(s,"height",!0)+this.verticalOffset;this.columns[o].push(s);h++}return l(y),Math.max.apply(Math,r)},i.prototype.layoutColumns=function(n,t){for(var i,s,r,v,h=[],c=[],e=0,a=0,o=this.columns.length;o--;){for(i=this.outerOffset,h.push(i),s=this.columns[o],v=o*n+t,e=0;e<s.length;e++,a++)r=s[e],f(r,"top",i),c[a]={el:r,css:{top:i+"px"}},c[a].css[this.direction]=v+"px",i+=u(r,"height",!0)+this.verticalOffset;h[o]=i}return l(c),Math.max.apply(Math,h)},i.prototype.clear=function(){clearTimeout(this.resizeTimer);for(var t=this.placeholders.length;t--;)this.container.removeChild(this.placeholders[t]);o(n,"resize",this.onResize);o(this.container,"refreshWookmark",this.onRefresh)},void 0!==n.jQuery&&(jQuery.fn.wookmark=function(n){var t=this.length;if(void 0!==n&&n.container instanceof jQuery&&(n.container=n.container[0]),t>1)for(;t--;)$(this).eq(t).wookmark(n);else 1===t&&(this.wookmarkInstance?this.wookmarkInstance.updateOptions(n||{}):this.wookmarkInstance=new i(this[0],n||{}));return this}),n.Wookmark=i,i})